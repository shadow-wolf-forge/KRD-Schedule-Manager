<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Calendar - Teams Style | GitHub Sync</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            color: #2d2d2d;
            height: 100vh;
            overflow: hidden;
        }

        /* Header - Teams Style */
        .header {
            background: linear-gradient(90deg, #ffffff 0%, #f8f9fa 100%);
            height: 60px;
            border-bottom: 1px solid #d1d1d1;
            display: flex;
            align-items: center;
            padding: 0 32px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title {
            font-size: 24px;
            font-weight: 700;
            color: #1f1f1f;
            margin-right: 24px;
        }

        /* Navigation Bar */
        .nav-bar {
            background: #ffffff;
            height: 56px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            padding: 0 24px;
            gap: 16px;
        }

        .nav-btn {
            width: 40px;
            height: 40px;
            border: 1px solid #c8c6c4;
            background: #ffffff;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
        }

        .nav-btn:hover {
            background: #f3f2f1;
            border-color: #8a8886;
        }

        .date-display {
            font-size: 18px;
            font-weight: 600;
            min-width: 220px;
            text-align: center;
            color: #323130;
        }

        .view-selector {
            margin-left: auto;
            display: flex;
            gap: 8px;
        }

        .view-btn {
            padding: 8px 20px;
            border: 1px solid #c8c6c4;
            background: #ffffff;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .view-btn.active, .view-btn:hover {
            background: #0078d4;
            color: white;
            border-color: #0078d4;
        }

        /* Main Calendar Container */
        .calendar-container {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* WEEK VIEW */
        .week-view {
            display: none;
            flex: 1;
            background: #ffffff;
        }

        .week-view.active {
            display: flex;
            flex-direction: column;
        }

        .week-grid {
            display: grid;
            grid-template-columns: 80px 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
            grid-template-rows: 56px 1fr;
            height: 100%;
            font-size: 13px;
        }

        .time-header {
            grid-row: 1;
            background: #faf9f8;
            border-right: 1px solid #edebe9;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #605e5c;
            padding: 12px 8px;
        }

        .day-header {
            height: 56px;
            background: #f3f2f1;
            border-bottom: 2px solid #edebe9;
            border-right: 1px solid #edebe9;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #323130;
            position: relative;
        }

        .day-header.today {
            background: linear-gradient(135deg, #0078d4, #106ebe);
            color: white;
        }

        .day-date {
            font-size: 20px;
            font-weight: 700;
            line-height: 1;
        }

        .day-name {
            font-size: 12px;
            margin-top: 2px;
            opacity: 0.8;
        }

        .time-slot {
            height: 60px;
            border-bottom: 1px solid #f0f0f0;
            border-right: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            padding-left: 12px;
            background: #faf9f8;
            font-size: 12px;
            color: #8a8886;
            position: relative;
        }

        .time-slot:nth-child(even) {
            background: #ffffff;
        }

        .day-column {
            position: relative;
            overflow: hidden;
            min-height: 0;
        }

        /* DAY VIEW */
        .day-view {
            display: none;
            flex: 1;
            background: #ffffff;
        }

        .day-view.active {
            display: flex;
            flex-direction: column;
        }

        .day-grid {
            display: grid;
            grid-template-columns: 80px 1fr;
            grid-template-rows: 56px 1fr;
            height: 100%;
        }

        /* WORK WEEK VIEW */
        .workweek-view {
            display: none;
            flex: 1;
            background: #ffffff;
        }

        .workweek-view.active {
            display: flex;
            flex-direction: column;
        }

        .workweek-grid {
            display: grid;
            grid-template-columns: 80px 1fr 1fr 1fr 1fr 1fr;
            grid-template-rows: 56px 1fr;
            height: 100%;
        }

        /* MONTH VIEW */
        .month-view {
            display: none;
            flex: 1;
            background: #ffffff;
        }

        .month-view.active {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: 60px repeat(5, 1fr);
            gap: 1px;
            background: #edebe9;
        }

        .month-header {
            background: #f3f2f1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            color: #323130;
        }

        .month-day {
            background: white;
            min-height: 120px;
            position: relative;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .month-day:hover {
            background: #f8f9fa;
        }

        .month-day.today {
            background: #e3f2fd;
            box-shadow: inset 0 0 0 2px #0078d4;
        }

        .month-day-header {
            font-weight: 600;
            margin-bottom: 8px;
            color: #605e5c;
        }

        /* EVENTS - Teams Style */
        .event {
            position: absolute;
            left: 8px;
            right: 8px;
            margin: 2px 0;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            border-left: 4px solid;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            transition: all 0.2s ease;
            user-select: none;
        }

        .event:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .event.meeting { 
            background: linear-gradient(135deg, #fff2cc, #ffeaa7); 
            border-left-color: #ffb900; 
            color: #d13438; 
        }
        .event.personal { 
            background: linear-gradient(135deg, #d1ecf1, #bee5eb); 
            border-left-color: #17a2b8; 
            color: #155724; 
        }
        .event.task { 
            background: linear-gradient(135deg, #f8d7da, #f5c6cb); 
            border-left-color: #dc3545; 
            color: #721c24; 
        }
        .event.note { 
            background: linear-gradient(135deg, #e2e3e5, #dee2e6); 
            border-left-color: #6c757d; 
            color: #495057; 
        }

        .event-time {
            font-size: 11px;
            opacity: 0.8;
            margin-bottom: 2px;
        }

        /* ADD EVENT BUTTON */
        .add-event-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #0078d4, #106ebe);
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,120,212,0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .add-event-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 24px rgba(0,120,212,0.5);
        }

        /* MODAL - Teams Style */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 520px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-header {
            padding: 24px 28px 16px;
            border-bottom: 1px solid #edebe9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 700;
            color: #1f1f1f;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: none;
            font-size: 24px;
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #605e5c;
        }

        .modal-close:hover {
            background: #f3f2f1;
            color: #323130;
        }

        .modal-body {
            padding: 24px 28px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #323130;
            margin-bottom: 8px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #c8c6c4;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.2s;
            background: #ffffff;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #0078d4;
            box-shadow: 0 0 0 3px rgba(0,120,212,0.1);
        }

        .time-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .modal-actions {
            padding: 20px 28px 28px;
            border-top: 1px solid #edebe9;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0078d4, #106ebe);
            color: white;
            min-width: 100px;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #106ebe, #005a9e);
        }

        .btn-secondary {
            background: #f3f2f1;
            color: #323130;
        }

        .btn-secondary:hover {
            background: #edebe9;
        }

        .btn-danger {
            background: #d13438;
            color: white;
        }

        .btn-danger:hover {
            background: #a4262b;
        }

        /* Loading & Status */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            backdrop-filter: blur(4px);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0078d4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-indicator {
            position: fixed;
            top: 80px;
            right: 24px;
            padding: 8px 16px;
            background: #0078d4;
            color: white;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .status-indicator.show {
            opacity: 1;
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-title">Schedule Manager</div>
    </div>

    <!-- Navigation -->
    <div class="nav-bar">
        <button class="nav-btn" id="prevBtn">â€¹</button>
        <div class="date-display" id="dateDisplay">February 6, 2026</div>
        <button class="nav-btn" id="todayBtn">Today</button>
        <button class="nav-btn" id="nextBtn">â€º</button>
        <div class="view-selector">
            <button class="view-btn active" data-view="day">Day</button>
            <button class="view-btn" data-view="week">Week</button>
            <button class="view-btn" data-view="workweek">Work week</button>
            <button class="view-btn" data-view="month">Month</button>
        </div>
    </div>

    <!-- Calendar Container -->
    <div class="calendar-container">
        <!-- DAY VIEW -->
        <div class="day-view active" id="dayView">
            <div class="day-grid">
                <div class="time-header">Time</div>
                <div class="day-header" id="dayHeader">
                    <div class="day-date" id="dayDate">6</div>
                    <div class="day-name" id="dayName">Friday</div>
                </div>
                <div></div>
                <div class="day-column" id="dayColumn"></div>
            </div>
        </div>

        <!-- WEEK VIEW -->
        <div class="week-view" id="weekView">
            <div class="week-grid" id="weekGrid">
                <div class="time-header">Time</div>
            </div>
        </div>

        <!-- WORK WEEK VIEW -->
        <div class="workweek-view" id="workweekView">
            <div class="workweek-grid" id="workweekGrid">
                <div class="time-header">Time</div>
            </div>
        </div>

        <!-- MONTH VIEW -->
        <div class="month-view" id="monthView">
            <!-- Dynamic content -->
        </div>
    </div>

    <!-- Add Event Button -->
    <button class="add-event-btn" id="addEventBtn" title="New Event">+</button>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Status Indicator -->
    <div class="status-indicator" id="statusIndicator"></div>

    <!-- Event Modal -->
    <div class="modal-overlay" id="eventModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">New Event</div>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" id="eventTitle" placeholder="Add title">
                </div>
                <div class="time-row">
                    <div class="form-group">
                        <label class="form-label">Start</label>
                        <input type="time" class="form-input" id="startTime">
                    </div>
                    <div class="form-group">
                        <label class="form-label">End</label>
                        <input type="time" class="form-input" id="endTime">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="eventType">
                        <option value="meeting">Meeting</option>
                        <option value="personal">Personal</option>
                        <option value="task">Task</option>
                        <option value="note">Note</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" id="eventLocation" placeholder="Where?">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="eventNotes" rows="3" placeholder="Additional details..."></textarea>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelBtn">Cancel</button>
                <button class="btn btn-danger" id="deleteBtn" style="display: none;">Delete</button>
                <button class="btn btn-primary" id="saveBtn">Save</button>
            </div>
        </div>
    </div>

    <script>
        class ScheduleManager {
            constructor() {
                // âœ… HARDCODED TOKEN PARTS (Non-Prod)
                this.tokenParts = [
                    'github_pat_11BXK4LGI04JGlMDCAifkL',
                    '_t6TN6IsmvBKrvs5DFt7TNTrIvsLLEnx4Q',
                    'nxPYntPeWXF2BT36NT8IYAjxR0'
                ];
                
                this.currentDate = new Date(); // âœ… REALTIME DATE
                this.currentView = 'day';
                this.events = [];
                this.repoOwner = 'shadow-wolf-forge';
                this.repoName = 'KRD-Schedule-Manager';
                this.filePath = 'events.json';
                this.editingEventId = null;
                
                this.init();
            }

            init() {
                this.loadEventsFromGitHub();
                this.bindEvents();
                this.render();
                this.updateDateDisplay();
                
                // Auto-save every 30 seconds
                setInterval(() => this.autoSave(), 30000);
            }

            async loadEventsFromGitHub() {
                try {
                    this.showLoading(true);
                    showStatus('ðŸ”„ Syncing with GitHub...', 'info');
                    
                    const token = this.tokenParts.join('');
                    const url = `https://api.github.com/repos/${this.repoOwner}/${this.repoName}/contents/${this.filePath}`;
                    
                    const response = await fetch(url, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        const file = await response.json();
                        this.events = JSON.parse(atob(file.content));
                        showStatus('âœ… Events loaded from GitHub!', 'success');
                    } else {
                        this.events = [];
                        showStatus('ðŸ“ Starting fresh (no events file)', 'info');
                    }
                    
                    // Load local backup
                    const localBackup = JSON.parse(localStorage.getItem('backupEvents') || '[]');
                    this.events.push(...localBackup);
                    this.events = this.deduplicateEvents(this.events);
                    
                } catch (error) {
                    console.error('GitHub sync failed:', error);
                    showStatus('âš ï¸ Using local backup only', 'warning');
                    this.events = JSON.parse(localStorage.getItem('backupEvents') || '[]');
                } finally {
                    this.showLoading(false);
                }
            }

            async saveEventsToGitHub() {
                try {
                    this.showLoading(true);
                    showStatus('ðŸ’¾ Saving to GitHub...', 'info');
                    
                    const token = this.tokenParts.join('');
                    const content = btoa(JSON.stringify(this.events, null, 2));
                    
                    // Get current file for SHA
                    const fileUrl = `https://api.github.com/repos/${this.repoOwner}/${this.repoName}/contents/${this.filePath}`;
                    const fileResponse = await fetch(fileUrl, {
                        headers: { 'Authorization': `token ${token}` }
                    });
                    const currentFile = await fileResponse.json().catch(() => null);
                    
                    const commitData = {
                        message: `Update events - ${new Date().toISOString()}`,
                        content: content,
                        sha: currentFile?.sha
                    };
                    
                    await fetch(fileUrl, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(commitData)
                    });
                    
                    // Backup locally
                    localStorage.setItem('backupEvents', JSON.stringify(this.events));
                    showStatus('âœ… Synced with GitHub!', 'success');
                    
                } catch (error) {
                    console.error('Save failed:', error);
                    localStorage.setItem('backupEvents', JSON.stringify(this.events));
                    showStatus('ðŸ’¾ Saved locally only', 'warning');
                } finally {
                    this.showLoading(false);
                }
            }

            deduplicateEvents(events) {
                const seen = new Set();
                return events.filter(event => {
                    if (seen.has(event.id)) return false;
                    seen.add(event.id);
                    return true;
                });
            }

            bindEvents() {
                // Navigation
                document.getElementById('prevBtn').onclick = () => this.navigate(-1);
                document.getElementById('nextBtn').onclick = () => this.navigate(1);
                document.getElementById('todayBtn').onclick = () => this.goToToday();

                // View switching
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.currentView = btn.dataset.view;
                        document.querySelectorAll('[class*="-view"]').forEach(v => v.classList.remove('active'));
                        document.getElementById(this.currentView + 'View').classList.add('active');
                        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.render();
                    });
                });

                // Event modal
                document.getElementById('addEventBtn').onclick = () => this.openEventModal();
                document.getElementById('saveBtn').onclick = () => this.saveEvent();
                document.getElementById('cancelBtn').onclick = () => this.closeEventModal();
                document.getElementById('modalClose').onclick = () => this.closeEventModal();
                document.getElementById('deleteBtn').onclick = () => this.deleteEvent();
            }

            navigate(direction) {
                if (this.currentView === 'day') {
                    this.currentDate.setDate(this.currentDate.getDate() + direction);
                } else if (['week', 'workweek'].includes(this.currentView)) {
                    this.currentDate.setDate(this.currentDate.getDate() + (7 * direction));
                } else if (this.currentView === 'month') {
                    this.currentDate.setMonth(this.currentDate.getMonth() + direction);
                }
                this.render();
                this.updateDateDisplay();
            }

            goToToday() {
                this.currentDate = new Date();
                this.render();
                this.updateDateDisplay();
            }

            updateDateDisplay() {
                const display = document.getElementById('dateDisplay');
                if (this.currentView === 'day') {
                    display.textContent = this.currentDate.toLocaleDateString('en-US', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                } else if (this.currentView === 'week' || this.currentView === 'workweek') {
                    const start = new Date(this.currentDate);
                    start.setDate(start.getDate() - start.getDay());
                    const end = new Date(start);
                    end.setDate(end.getDate() + 6);
                    display.textContent = `${start.toLocaleDateString('en-US', {month: 'short', day: 'numeric'})} - ${end.toLocaleDateString('en-US', {month: 'short', day: 'numeric'})}`;
                } else {
                    display.textContent = this.currentDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long' });
                }
            }

            render() {
                this.clearEvents();
                if (this.currentView === 'day') this.renderDayView();
                else if (this.currentView === 'week') this.renderWeekView();
                this.renderEvents();
                this.updateTodayHighlight();
            }

            renderDayView() {
                const dayDate = document.getElementById('dayDate');
                const dayName = document.getElementById('dayName');
                dayDate.textContent = this.currentDate.getDate();
                dayName.textContent = this.currentDate.toLocaleDateString('en-US', { weekday: 'long' });
            }

            renderWeekView() {
                const weekGrid = document.getElementById('weekGrid');
                weekGrid.innerHTML = '<div class="time-header">Time</div>';
                
                // Day headers
                for (let i = 0; i < 7; i++) {
                    const date = new Date(this.currentDate);
                    date.setDate(date.getDate() - date.getDay() + i);
                    const isToday = date.toDateString() === new Date().toDateString();
                    const dayHeader = document.createElement('div');
                    dayHeader.className = `day-header ${isToday ? 'today' : ''}`;
                    dayHeader.dataset.day = i;
                    dayHeader.innerHTML = `
                        <div class="day-date">${date.getDate()}</div>
                        <div class="day-name">${date.toLocaleDateString('en-US', {weekday: 'short'})}</div>
                    `;
                    weekGrid.appendChild(dayHeader);
                }
                
                // Time slots (24 hours)
                for (let hour = 0; hour < 24; hour++) {
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'time-slot';
                    timeSlot.textContent = this.formatHour(hour);
                    weekGrid.appendChild(timeSlot);
                    
                    for (let day = 0; day < 7; day++) {
                        const dayColumn = document.createElement('div');
                        dayColumn.className = 'day-column';
                        dayColumn.dataset.day = day;
                        weekGrid.appendChild(dayColumn);
                    }
                }
            }

            formatHour(hour) {
                const period = hour < 12 ? 'AM' : 'PM';
                const displayHour = hour % 12 || 12;
                return `${displayHour}:00 ${period}`;
            }

            getVisibleEvents() {
                return this.events.filter(event => {
                    const eventDate = new Date(event.date);
                    const viewDate = new Date(this.currentDate);
                    
                    if (this.currentView === 'day') {
                        return eventDate.toDateString() === viewDate.toDateString();
                    }
                    return true; // Show all for week/month
                });
            }

            renderEvents() {
                this.getVisibleEvents().forEach(event => {
                    this.renderSingleEvent(event);
                });
            }

            renderSingleEvent(event) {
                let targetColumn;
                
                if (this.currentView === 'day') {
                    targetColumn = document.getElementById('dayColumn');
                } else {
                    const dayColumns = document.querySelectorAll('.day-column[data-day]');
                    const eventDayIndex = 0; // Simplified
                    targetColumn = dayColumns[eventDayIndex];
                }
                
                if (!targetColumn) return;

                const eventEl = document.createElement('div');
                eventEl.className = `event ${event.type}`;
                eventEl.dataset.eventId = event.id;
                eventEl.innerHTML = `
                    <div class="event-time">${event.start.slice(0,5)} - ${event.end.slice(0,5)}</div>
                    ${event.title}
                `;
                
                eventEl.style.top = this.timeToPercent(event.start) + '%';
                eventEl.style.height = this.durationToPercent(event.start, event.end) + '%';
                
                eventEl.addEventListener('click', () => this.editEvent(event));
                targetColumn.appendChild(eventEl);
            }

            timeToPercent(timeStr) {
                const [hours, minutes] = timeStr.split(':').map(Number);
                return (hours * 60 + minutes) / 1440 * 100;
            }

            durationToPercent(start, end) {
                const startMin = start.split(':').map(Number).reduce((a,b) => a*60 + b);
                const endMin = end.split(':').map(Number).reduce((a,b) => a*60 + b);
                return (endMin - startMin) / 1440 * 100;
            }

            clearEvents() {
                document.querySelectorAll('.event').forEach(el => el.remove());
            }

            updateTodayHighlight() {
                const today = new Date();
                document.querySelectorAll('.day-header').forEach(header => {
                    const date = new Date(this.currentDate);
                    date.setDate(date.getDate() + parseInt(header.dataset.day || 0));
                    if (date.toDateString() === today.toDateString()) {
                        header.classList.add('today');
                    } else {
                        header.classList.remove('today');
                    }
                });
            }

            openEventModal(event = null) {
                const titleEl = document.getElementById('modalTitle');
                const deleteBtn = document.getElementById('deleteBtn');
                
                if (event) {
                    titleEl.textContent = 'Edit Event';
                    deleteBtn.style.display = 'inline-block';
                    this.populateForm(event);
                    this.editingEventId = event.id;
                } else {
                    titleEl.textContent = 'New Event';
                    deleteBtn.style.display = 'none';
                    this.clearForm();
                    this.editingEventId = null;
                }
                
                document.getElementById('eventModal').style.display = 'flex';
                document.getElementById('eventTitle').focus();
            }

            populateForm(event) {
                document.getElementById('eventTitle').value = event.title || '';
                document.getElementById('startTime').value = event.start || '09:00';
                document.getElementById('endTime').value = event.end || '10:00';
                document.getElementById('eventType').value = event.type || 'meeting';
                document.getElementById('eventLocation').value = event.location || '';
                document.getElementById('eventNotes').value = event.notes || '';
            }

            clearForm() {
                document.getElementById('eventTitle').value = '';
                document.getElementById('startTime').value = '09:00';
                document.getElementById('endTime').value = '10:00';
                document.getElementById('eventType').value = 'meeting';
                document.getElementById('eventLocation').value = '';
                document.getElementById('eventNotes').value = '';
            }

            async saveEvent() {
                const title = document.getElementById('eventTitle').value.trim();
                if (!title) return showStatus('âš ï¸ Event needs a title', 'warning');

                const eventData = {
                    id: this.editingEventId || Date.now().toString(),
                    title,
                    start: document.getElementById('startTime').value,
                    end: document.getElementById('endTime').value,
                    type: document.getElementById('eventType').value,
                    location: document.getElementById('eventLocation').value,
                    notes: document.getElementById('eventNotes').value,
                    date: this.currentDate.toISOString().split('T')[0]
                };

                if (this.editingEventId) {
                    const index = this.events.findIndex(e => e.id === this.editingEventId);
                    this.events[index] = eventData;
                } else {
                    this.events.push(eventData);
                }

                await this.saveEventsToGitHub();
                this.render();
                this.closeEventModal();
            }

            async deleteEvent() {
                if (this.editingEventId) {
                    this.events = this.events.filter(e => e.id !== this.editingEventId);
                    await this.saveEventsToGitHub();
                    this.render();
                    this.closeEventModal();
                }
            }

            closeEventModal() {
                document.getElementById('eventModal').style.display = 'none';
            }

            editEvent(event) {
                this.openEventModal(event);
            }

            autoSave() {
                if (this.events.length > 0) {
                    this.saveEventsToGitHub();
                }
            }

            showLoading(show) {
                document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
            }
        }

        // Global status helper
        function showStatus(message, type = 'info') {
            const indicator = document.getElementById('statusIndicator');
            indicator.textContent = message;
            indicator.className = `status-indicator show ${type}`;
            setTimeout(() => indicator.classList.remove('show'), 3000);
        }

        // Modal backdrop clicks
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('eventModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    calendar.closeEventModal();
                }
            });
        });

        // Initialize
        const calendar = new ScheduleManager();
    </script>
</body>
</html>
